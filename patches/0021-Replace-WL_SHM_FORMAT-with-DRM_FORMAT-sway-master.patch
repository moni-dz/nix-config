From 8bcd95966ab9b3cb6188c90b7c5e74d9b2486170 Mon Sep 17 00:00:00 2001
From: Robert Miller <legomaster57@gmail.com>
Date: Sat, 27 Feb 2021 15:11:12 -0500
Subject: [PATCH 21/24] Replace WL_SHM_FORMAT with DRM_FORMAT sway master

---
 sway/commands/border_images.c | 3 ++-
 sway/tree/container.c         | 8 +++++---
 2 files changed, 7 insertions(+), 4 deletions(-)

diff --git a/sway/commands/border_images.c b/sway/commands/border_images.c
index d6f5ec63..7d7cf36a 100644
--- a/sway/commands/border_images.c
+++ b/sway/commands/border_images.c
@@ -1,5 +1,6 @@
 #define _POSIX_C_SOURCE 200809L
 #include <wlr/render/wlr_renderer.h>
+#include <drm_fourcc.h>
 #include <string.h>
 #include "cairo.h"
 #include "log.h"
@@ -12,7 +13,7 @@ static void apply_border_textures_for_class(struct border_textures *class) {
 	struct sway_output *output = root->outputs->items[0];
 	struct wlr_renderer *renderer = wlr_backend_get_renderer(
 			output->wlr_output->backend);
-	class->texture = wlr_texture_from_pixels(renderer, WL_SHM_FORMAT_ARGB8888,
+	class->texture = wlr_texture_from_pixels(renderer, DRM_FORMAT_ARGB8888,
 		cairo_image_surface_get_width(class->image_surface) * 4,
 		cairo_image_surface_get_width(class->image_surface),
 		cairo_image_surface_get_height(class->image_surface),
diff --git a/sway/tree/container.c b/sway/tree/container.c
index d2e04c2a..809034c3 100644
--- a/sway/tree/container.c
+++ b/sway/tree/container.c
@@ -558,9 +558,11 @@ static void render_titlebar_text_texture(struct sway_output *output,
 
 	cairo_surface_flush(surface);
 	unsigned char *data = cairo_image_surface_get_data(surface);
-	int stride = cairo_image_surface_get_stride(surface);
-	struct wlr_renderer *renderer = output->wlr_output->renderer;
-	*texture = wlr_texture_from_pixels(renderer, WL_SHM_FORMAT_ARGB8888, stride, width, height, data);
+	int stride = cairo_format_stride_for_width(CAIRO_FORMAT_ARGB32, width);
+	struct wlr_renderer *renderer = wlr_backend_get_renderer(
+			output->wlr_output->backend);
+	*texture = wlr_texture_from_pixels(
+			renderer, DRM_FORMAT_ARGB8888, stride, width, height, data);
 
 	cairo_surface_destroy(surface);
 	g_object_unref(pango);
-- 
2.35.1

